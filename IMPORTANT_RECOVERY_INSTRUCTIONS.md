**Руководство по восстановлению Android-проекта после случайного удаления ключевых файлов (.jks, gradle.properties, local.properties)**

Если вы случайно удалили файлы `my-release-key.jks`, любые другие `.jks` файлы, `gradle.properties` и `local.properties` из своего Android-проекта, не паникуйте. Большинство из этих файлов можно воссоздать или восстановить, хотя потеря ключа подписи релиза может иметь серьезные последствия.

**Шаг 1: Поймите важность удаленных файлов**

*   **`.jks` файлы (хранилища ключей)**: Содержат ключи, используемые для цифровой подписи вашего приложения. Это КРИТИЧЕСКИ ВАЖНО для выпуска обновлений в магазинах приложений (например, Google Play). Если вы ПОТЕРЯЛИ КЛЮЧ ПОДПИСИ ВЫПУСКА БЕЗ РЕЗЕРВНОЙ КОПИИ, вы НЕ СМОЖЕТЕ обновлять существующее приложение. Вам придется публиковать его как совершенно новое приложение с новым ключом и новым именем пакета.
*   **`gradle.properties`**: Содержит свойства проекта Gradle, которые могут включать настройки сборки, информацию о репозиториях, и, возможно, данные для подписи приложения (имена файлов ключей, псевдонимы, но НЕ пароли из соображений безопасности – пароли должны храниться вне контроля версий).
*   **`local.properties`**: Содержит путь к вашему Android SDK (`sdk.dir`). Этот файл специфичен для вашей локальной среды и почти всегда должен игнорироваться в Git.

**Шаг 2: Поиск резервных копий (.jks ключей)**

Прежде всего, тщательно проверьте все возможные места, где у вас могли быть резервные копии ваших `.jks` ключей: внешние диски, облачные хранилища, старые папки с проектами. Если вы найдете резервную копию ключа, вы сможете использовать ее вместо создания нового.

**Шаг 3: Воссоздание `local.properties`**

Этот файл легко воссоздать.
1.  В корневой директории вашего проекта создайте новый файл с именем `local.properties`.
2.  Откройте его в текстовом редакторе или IDE.
3.  Добавьте следующую строку, заменив `/path/to/your/android/sdk` на **актуальный путь** к вашему Android SDK на вашей машине:
    ```properties
sdk.dir=C:\\Users\\ВашеИмяПользователя\\AppData\\Local\\Android\\Sdk
    ```
    (Путь может отличаться; найдите его в Android Studio: `File > Settings (или Preferences) > Appearance & Behavior > System Settings > Android SDK Location`). Убедитесь, что в конце пути нет лишних пробелов! Используйте двойные обратные слэши `\\` для Windows путей.

**Шаг 4: Воссоздание `gradle.properties`**

Этот файл может быть пустым изначально, но лучше добавить стандартные комментарии.
1.  В корневой директории вашего проекта создайте новый файл с именем `gradle.properties`.
2.  Откройте его и добавьте:
    ```properties
# This file can be used to include project-wide Gradle settings.
# For more information about Gradle properties, see the Gradle documentation at https://docs.gradle.org/current/userguide/build_environment.html
    ```
    Позже мы добавим сюда настройки для подписи и другие свойства.

**Шаг 5: Обработка потери ключа подписи релиза (.jks)**

Если вы **НЕ НАШЛИ** резервную копию вашего старого `.jks` ключа:
1.  Вы должны сгенерировать новый ключ. Помните, что это потребует публикации вашего приложения как **НОВОГО** в магазинах приложений.
2.  Откройте терминал (например, PowerShell на Windows).
3.  Перейдите в директорию, где вы хотите создать `.jks` файл. **Рекомендуется создать его в директории `app/` вашего проекта.** Используйте команду `cd`:

cd C:\Users\\ВашеИмяПользователя\\AndroidStudioProjects\\ВашПроект\\app
    ```
4.  Выполните команду `keytool`. Замените `<ваше_имя_ключа>` на желаемое имя для вашего файла (например, `new_release_key`) и `<ваш_псевдоним>` на желаемый псевдоним (например, `myalias`):

keytool -genkeypair -v -keystore <ваше_имя_ключа>.jks -alias <ваш_псевдоним> -keyalg RSA -keysize 2048 -validity 10000

5.  `keytool` запросит у вас пароли (для хранилища и ключа) и информацию о вас/организации. Вводите данные по запросу. **ОБЯЗАТЕЛЬНО ЗАПИШИТЕ И НАДЕЖНО СОХРАНИТЕ:**
    *   Имя файла ключа (`<ваше_имя_ключа>.jks`)
    *   Псевдоним ключа (`<ваш_псевдоним>`)
    *   Пароль для хранилища ключей (Keystore password)
    *   Пароль для ключа (Key password)
    Сделайте резервную копию файла `.jks` и этих данных в безопасном месте, ОТДЕЛЬНО от проекта и Git.
6.  Если вы создали файл `.jks` не в директории `app/`, переместите его туда сейчас.

**Шаг 6: Настройка подписи в Gradle**

Мы добавим данные о вашем новом ключе в `gradle.properties` и настроим `app/build.gradle.kts` для их использования.
1.  Откройте файл `gradle.properties` (в корне проекта).
2.  Добавьте в конец следующие строки, **заменив значения** на те, которые вы использовали при создании ключа:
    ```properties
# Key store properties
# Make sure this file is NOT committed to version control!
MY_RELEASE_STORE_FILE=<ваше_имя_ключа>.jks # Например, new_release_key.jks
MY_RELEASE_STORE_PASSWORD=<ваш_пароль_хранилища>
MY_RELEASE_KEY_ALIAS=<ваш_псевдоним> # Например, myalias (включая любые символы, как '>' если keytool его добавил!)
MY_RELEASE_KEY_PASSWORD=<ваш_пароль_ключа>
    ```
    *Проверка псевдонима:* Если при сборке возникает ошибка "No key with alias '<ваш_псевдоним>' found", возможно, фактический псевдоним в `.jks` файле отличается. Проверьте его с помощью `keytool -list -v -keystore <ваш_файл_ключа>.jks` в терминале в директории `app/` и исправьте `MY_RELEASE_KEY_ALIAS` в `gradle.properties`.

3.  Откройте файл `app/build.gradle.kts` (в директории `app/`).
4.  Найдите блок `android { ... }` и внутри него секцию `signingConfigs`. Измените или добавьте секцию `signingConfigs` так, чтобы она читала данные из `gradle.properties`:
    ```kotlin
android {
    // ... другие настройки android ...
    signingConfigs {
        create("release") {
            // Использовать свойства из gradle.properties
            storeFile = file(project.findProperty("MY_RELEASE_STORE_FILE") as String)
            storePassword = project.findProperty("MY_RELEASE_STORE_PASSWORD") as String
            keyAlias = project.findProperty("MY_RELEASE_KEY_ALIAS") as String
            keyPassword = project.findProperty("MY_RELEASE_KEY_PASSWORD") as String
        }
    }
    // ... другие секции (defaultConfig, buildTypes и т.д.) ...
    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release") // Убедитесь, что релизная сборка использует эту конфигурацию подписи
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
    // ... остальная часть android блока ...
}
    ```

**Шаг 7: Добавление стандартных настроек Gradle в `gradle.properties` (для исправления распространенных ошибок)**

Откройте файл `gradle.properties` (в корне проекта) и добавьте в конец следующие строки (если их там еще нет):
```properties
android.useAndroidX=true   # Включает использование библиотек AndroidX
android.enableSigs=true    # Явно включает поддержку конфигурации подписи (часто не требуется, но может помочь)
org.gradle.jvmargs=-Xmx2g  # Увеличивает память для Gradle (исправляет OutOfMemoryError)
    ```
Значение `-Xmx2g` означает выделение 2 ГБ памяти. Если проект большой, возможно, потребуется увеличить до `-Xmx4g`.

**Шаг 8: Настройка `.gitignore`**

КРАЙНЕ ВАЖНО, чтобы генерируемые файлы, ваши ключи и файлы с конфиденциальными данными НЕ ПОПАЛИ в ваш репозиторий Git. Убедитесь, что ваш файл `.gitignore` (в корне проекта) включает правила для игнорирования следующих элементов:

```gitignore
# Игнорируйте все сгенерированные папки и файлы IDE/сборки
*.iml
.gradle/
/local.properties         # Игнорировать local.properties с локальным путем к SDK
/.idea/                   # Игнорировать папку .idea (или выборочно игнорировать подпапки/файлы внутри, как в вашем примере)
/build/
/captures/
.externalNativeBuild/
.cxx/
caches/
.tmp/
native/
wrapper/             # <--- Папка wrapper в корне (не gradle/wrapper)
android/FakeDependency.jar # Если такой файл генерируется

# Конфиденциальные файлы - НЕ ДОЛЖНЫ ПОПАСТЬ В GIT!
# Используйте файлы .example для предоставления шаблонов команде.
*.jks                     # Игнорировать все файлы хранилищ ключей (.jks)
gradle.properties         # Игнорировать gradle.properties с вашими данными и паролями
    ```
*(Вы можете оставить папки `.idea/` и `gradle/wrapper/` (та, что внутри `Lingro/gradle/`) НЕ игнорируемыми, так как они содержат полезные для команды настройки IDE и Wrapper'а соответственно. Но **содержимое** `.idea/caches`, `.gradle/`, `build/`, `caches/`, `daemon/`, корневой `wrapper/` **должно игнорироваться**)*

**Шаг 9: Исправление проблемы загрузки картинок (HTTP 404)**

Если в вашем приложении картинки не загружаются с ошибкой HTTP 404, и вы используете прокси на бэкенде для взаимодействия с OpenAI Vision API (как было в вашем случае):
1.  **Проблема:** Вероятно, ваш бэкенд-прокси использует устаревшее имя модели OpenAI Vision (`'gpt-4-vision-preview'`).
2.  **Решение:**
    *   Найдите код вашего бэкенд-прокси (например, файл `server.js` в папке `Lingro-Proxy`).
    *   Замените все вхождения `'gpt-4-vision-preview'` на актуальное имя модели, например `'gpt-4o'` или `'gpt-4-turbo'`. Актуальные имена моделей всегда проверяйте в документации OpenAI.
    *   **Внесите эти изменения в файл кода прокси ВРУЧНУЮ.**
    *   **Перезагрузите или переразверните ваш бэкенд-сервис** на платформе, где он размещен (например, Railway), чтобы изменения вступили в силу.

**Шаг 10: Тестирование сборки**

После выполнения всех этих шагов:
1.  Синхронизируйте проект с Gradle в Android Studio (`File > Sync Project with Gradle Files`).
2.  Попробуйте собрать релизную версию вашего приложения (`Build > Generate Signed Bundle / APK...`).
3.  Убедитесь, что сборка проходит без ошибок. Если возникают ошибки, проанализируйте их вывод в окне Build (или в терминале) и вернитесь к соответствующим шагам (ошибки могут указывать на проблемы с путем к SDK, памятью Gradle, псевдонимом ключа и т.д.).